<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.69">
<title data-react-helmet="true">Listeners | Kotest</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Listeners | Kotest"><meta data-react-helmet="true" name="description" content="It is a common requirement to execute code before or after tests or specs. For instance, to start (or reset) and shutdown an embedded database required by a test."><meta data-react-helmet="true" property="og:description" content="It is a common requirement to execute code before or after tests or specs. For instance, to start (or reset) and shutdown an embedded database required by a test."><meta data-react-helmet="true" property="og:url" content="https://kotest.io/docs/framework/listeners.html"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://kotest.io/docs/framework/listeners.html"><link rel="stylesheet" href="/styles.f70968a8.css">
<link rel="preload" href="/styles.6e1caf73.js" as="script">
<link rel="preload" href="/runtime~main.8c1cf63c.js" as="script">
<link rel="preload" href="/main.dc48cc50.js" as="script">
<link rel="preload" href="/1.d50575be.js" as="script">
<link rel="preload" href="/83.280073a3.js" as="script">
<link rel="preload" href="/84.2d7a49f0.js" as="script">
<link rel="preload" href="/935f2afb.2372d9e3.js" as="script">
<link rel="preload" href="/82.d1c7a466.js" as="script">
<link rel="preload" href="/a9df3900.e9d351a6.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Kotest" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/logo.png" alt="Kotest" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Kotest</strong></a><a class="navbar__item navbar__link" href="/docs/quickstart">Overview</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/framework/framework.html">Framework</a><a class="navbar__item navbar__link" href="/docs/extensions/extensions.html">Extensions</a><a class="navbar__item navbar__link" href="/docs/assertions/assertions.html">Assertions</a><a class="navbar__item navbar__link" href="/docs/proptest/property-based-testing.html">Property Testing</a><a class="navbar__item navbar__link" href="/docs/intellij/intellij-plugin.html">Intellij Plugin</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kotest/kotest/issues" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Issue Tracker</a><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Kotest" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/logo.png" alt="Kotest" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Kotest</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/quickstart">Overview</a></li><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/framework/framework.html">Framework</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/extensions/extensions.html">Extensions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/assertions/assertions.html">Assertions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/proptest/property-based-testing.html">Property Testing</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intellij/intellij-plugin.html">Intellij Plugin</a></li><li class="menu__list-item"><a href="https://github.com/kotest/kotest/issues" target="_blank" rel="noopener noreferrer" class="menu__link">Issue Tracker</a></li><li class="menu__list-item"><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive thin-scrollbar menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/framework/framework.html">Test Framework</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/testing-styles.html">Testing Styles</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/conditional-evaluation.html">Conditional Evaluation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/isolation-mode.html">Isolation Modes</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/exceptions.html">Exceptions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/data-driven-testing.html">Data Driven Testing</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Non-deterministic Testing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/eventually.html">Eventually</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/continually.html">Continually</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/until.html">Until</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/retry.html">Retry</a></li></ul></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/docs/framework/listeners.html">Listeners</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/plugins.html">Plugins</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Integrations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/framework/integrations/mocking.html">Mocking</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/framework/integrations/jacoco.html">Jacoco</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Ordering</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/framework/spec-ordering.html">Spec Ordering</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/framework/test-ordering.html">Test Ordering</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/tags.html">Grouping Tests with Tags</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Resources</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/framework/autoclose.html">Closing resources automatically</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/framework/temporary-files">Temporary Files</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/framework/testcaseconfig.html">Test Case Config</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/framework/project-config.html">Project Level Config</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/framework/framework-config-props.html">System properties</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/test-extensions.html">Test Extensions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/test-factories.html">Test Factories</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/timeouts.html">Timeouts</a></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Listeners</h1></header><div class="markdown"><p>It is a common requirement to execute code before or after tests or specs. For instance, to start (or reset) and shutdown an embedded database required by a test.</p><p>Kotest provides multiple callbacks into the test lifecycle which are used for this purpose.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="testlistener"></a>TestListener<a class="hash-link" href="#testlistener" title="Direct link to heading">#</a></h2><p>The main interface is <em>TestListener</em>. The following sections describe the callbacks available on this interface.</p><table><thead><tr><th>Callback</th><th>Description</th></tr></thead><tbody><tr><td>beforeContainer</td><td>Invoked directly before each test with type <code>TestType.Container</code> is executed, with the <code>TestCase</code> instance as a parameter. If the test is marked as ignored / disabled / inactive, then this callback won&#x27;t be invoked.</td></tr><tr><td>afterContainer</td><td>Invoked immediately after a <code>TestCase</code> with type <code>TestType.Container</code> has finished, with the <code>TestResult</code> of that test. If a test case was skipped (ignored / disabled / inactive) then this callback will not be invoked for that particular test case.<br><br>The callback will execute even if the test fails.</td></tr><tr><td>beforeEach</td><td>Invoked directly before each test with type <code>TestType.Test</code> is executed, with the <code>TestCase</code> instance as a parameter. If the test is marked as ignored / disabled / inactive, then this callback won&#x27;t be invoked.</td></tr><tr><td>afterEach</td><td>Invoked immediately after a <code>TestCase</code> with type <code>TestType.Test</code> has finished, with the <code>TestResult</code> of that test. If a test case was skipped (ignored / disabled / inactive) then this callback will not be invoked for that particular test case.<br><br>The callback will execute even if the test fails.</td></tr><tr><td>beforeAny</td><td>Invoked directly before each test with any <code>TestType</code> is executed, with the <code>TestCase</code> instance as a parameter. If the test is marked as ignored / disabled / inactive, then this callback won&#x27;t be invoked.</td></tr><tr><td>afterAny</td><td>Invoked immediately after a <code>TestCase</code> with any <code>TestType</code> has finished, with the <code>TestResult</code> of that test. If a test case was skipped (ignored / disabled / inactive) then this callback will not be invoked for that particular test case.<br><br>The callback will execute even if the test fails.</td></tr><tr><td>beforeTest</td><td>Invoked directly before each test is executed with the <code>TestCase</code> instance as a parameter. If the test is marked as ignored / disabled / inactive, then this callback won&#x27;t be invoked.<br><br>This callback has the same behavior as <code>beforeAny</code>.</td></tr><tr><td>afterTest</td><td>Invoked immediately after a <code>TestCase</code> has finished with the <code>TestResult</code> of that test. If a test case was skipped (ignored / disabled / inactive) then this callback will not be invoked for that particular test case.<br><br>The callback will execute even if the test fails.<br><br>This callback has the same behavior as <code>afterAny</code>.</td></tr><tr><td>beforeSpec</td><td>Invoked after the Engine instantiates a spec to be used as part of a test execution.<br><br>The callback is provided with the <code>Spec</code> instance that the test will be executed under.<br><br>If a spec is instantiated multiple times - for example, if <code>InstancePerTest</code> or <code>InstancePerLeaf</code> isolation modes are used, then this callback will be invoked for each instance created, just before the first test (or only test) is executed for that spec.<br><br>This callback should be used if you need to perform setup each time a new spec instance is created.<br><br>If you simply need to perform setup once per class file, then use prepareSpec. This callback runs before any <code>beforeTest</code> functions are invoked.<br><br> When running in the default <code>SingleInstance</code> isolation mode, then this callback and <code>prepareSpec</code> are functionally the same since all tests will run in the same spec instance.</td></tr><tr><td>afterSpec</td><td>Is invoked after the <code>TestCase</code>s that are part of a particular spec instance have completed.<br><br>If a spec is instantiated multiple times - for example, if <code>InstancePerTest</code> or <code>InstancePerLeaf</code> isolation modes are used, then this callback will be invoked for each instantiated spec, after the tests that are applicable to that spec instance have returned.<br><br>This callback should be used if you need to perform cleanup after each individual spec instance. If you need to perform cleanup once per class file, then use <code>finalizeSpec.</code><br><br>This callback runs after any <code>afterTest</code> callbacks have been invoked.<br><br>When running in the default <code>SingleInstance</code> isolation mode, then this callback and <code>finalizeSpec</code> are functionally the same since all tests will run in the same spec instance.</td></tr><tr><td>prepareSpec</td><td>Called once per spec, when the engine is preparing to execute the tests for that spec. The <code>KClass</code> instance of the spec is provided as a parameter.<br><br>Regardless of how many times the spec is instantiated, for example, if <code>InstancePerTest</code> or <code>InstancePerLeaf</code> isolation modes are used, this callback will only be invoked once. If there are no active tests in a spec, then this callback will still be invoked.<br><br>When running in the default <code>SingleInstance</code> isolation mode, then this callback and <code>beforeSpec</code> are functionally the same since all tests will run in the same spec instance.</td></tr><tr><td>finalizeSpec</td><td>Called once per <code>Spec</code>, after all tests have completed for that spec.<br><br>Regardless of how many times the spec is instantiated, for example, if <code>InstancePerTest</code> or <code>InstancePerLeaf</code> isolation modes are used, this callback will only be invoked once.<br><br>The results parameter contains every <code>TestCase</code>, along with the result of that test, including tests that were ignored (which will have a <code>TestResult</code> that has <code>TestStatus.Ignored</code>).<br><br>When running in the default <code>SingleInstance</code> isolation mode, then this callback and <code>afterSpec</code> are functionally the same since all tests will run in the same spec instance.</td></tr><tr><td>beforeInvocation</td><td>Invoked before each &#x27;run&#x27; of a test, with a flag indicating the iteration number. This callback is useful if you have set a test to have multiple invocations via config and want to do some setup / teardown between runs.<br><br>If you are running a test with the default single invocation then this callback is effectively the same as <code>beforeTest</code>.<br><br><em>Note: If you have set multiple invocations _and</em> multiple threads, then these callbacks will be invoked concurrently._</td></tr><tr><td>afterInvocation</td><td>Invoked after each &#x27;run&#x27; of a test, with a flag indicating the iteration number. This callback is useful if you have set a test to have multiple invocations via config and want to do some setup / teardown between runs.<br><br>If you are running a test with the default single invocation then this callback is effectively the same as <code>afterTest</code>.<br><br><em>Note: If you have set multiple invocations _and</em> multiple threads, then these callbacks will be invoked concurrently._</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="projectlistener"></a>ProjectListener<a class="hash-link" href="#projectlistener" title="Direct link to heading">#</a></h2><p>The other listener interface is <code>ProjectListener</code> which defines two callbacks.</p><table><thead><tr><th>Callback</th><th>Description</th></tr></thead><tbody><tr><td>beforeProject</td><td>This callback is invoked once before any spec discovery and execution takes place.</td></tr><tr><td>afterProject</td><td>This callback is invoked once after all specs have completed. This callback is executed even if there are errors in specs / test cases.</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="how-to-use-a-listener"></a>How to use a Listener<a class="hash-link" href="#how-to-use-a-listener" title="Direct link to heading">#</a></h2><p>There are several ways to use the methods in a listener.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="dsl-methods"></a>DSL Methods<a class="hash-link" href="#dsl-methods" title="Direct link to heading">#</a></h4><p>The first and simplest, is to use the DSL methods available inside a Spec which create and register a <code>TestListener</code> for you. For example, we can invoke <code>beforeTest</code> or <code>afterTest</code> (and others) directly alongside our tests.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class TestSpec : WordSpec({</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   beforeTest {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     println(&quot;Starting a test $it&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   afterTest { (test, result) -&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     println(&quot;Finished spec with result $result&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   &quot;this test&quot; should {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;be alive&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        println(&quot;Johnny5 is alive!&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">})</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Behind the scenes, these DSL methods will create an instance of <code>TestListener</code>, overriding the appropriate functions, and ensuring that this test listener is registered to run.</p><p>You can use <code>afterProject</code> as a DSL method which will create an instance of <code>ProjectListener</code>, but there is no <code>beforeProject</code> because by the time the framework is at this stage of detecting a spec, the project has already started!</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="dsl-methods-with-functions"></a>DSL methods with functions<a class="hash-link" href="#dsl-methods-with-functions" title="Direct link to heading">#</a></h4><p>Since these DSL methods accept functions, we can pull out logic to a function and re-use it in several places. The <code>BeforeTest</code> type used on the function definition is an alias
to <code>suspend (TestCase) -&gt; Unit</code> to keep things simple. There are aliases for the types of each of the callbacks.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">val startTest: BeforeTest = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   println(&quot;Starting a test $it&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class TestSpec : WordSpec({</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   // used once</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   beforeTest(startTest)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   &quot;this test&quot; should {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;be alive&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         println(&quot;Johnny5 is alive!&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class OtherSpec : WordSpec({</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   // used twice</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   beforeTest(startTest)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   &quot;this test&quot; should {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;fail&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         fail(&quot;boom&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">})</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="overriding-callback-functions-in-a-spec"></a>Overriding callback functions in a Spec<a class="hash-link" href="#overriding-callback-functions-in-a-spec" title="Direct link to heading">#</a></h4><p>The second, related, method is to override the callback functions in the Spec. This is essentially just a variation on the first method.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class TestSpec : WordSpec() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    override fun beforeTest(testCase: TestCase) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        println(&quot;Starting a test $testCase&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    init {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;this test&quot; should {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;be alive&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                println(&quot;Johnny5 is alive!&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="standalone-listener-instances"></a>Standalone Listener instances<a class="hash-link" href="#standalone-listener-instances" title="Direct link to heading">#</a></h4><p>The next method is to create a standalone implementation of the <code>TestListener</code> or <code>ProjectListener</code> interface and register it.</p><p>This is useful for <code>TestListener</code>s if you want to reuse a listener that has several dependant functions (such as starting and stopping a resource).</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class MyTestListener : TestListener {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   override suspend fun beforeSpec(spec:Spec) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      // power up kafka</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   override suspend fun afterSpec(spec: Spec) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      // shutdown kafka</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class TestSpec : WordSpec({</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    listener(MyTestListener())</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // tests here</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">})</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Any listeners registered directly inside a <code>Spec</code> will be used for all tests in that spec (including <a href="/docs/framework/test-factories.html">test factories</a> and nested tests).</p><p>Maybe you want a <code>TestListener</code> to run for every spec in the entire project. To do that, you can either mark the listener with <code>@AutoScan</code>, or you can register the listener via project config.
For more information on this see <a href="/docs/framework/project-config.html">ProjectConfig</a>.</p><p>Instances of <code>ProjectListener</code> must be registered using <code>@AutoScan</code> or using project config level, since the <code>beforeProject</code> callback needs to be registered and executed any spec discovery begins.</p><p>An example of <code>@Autoscan</code> on a project listener:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@AutoScan</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">object MyProjectListener : ProjectListener {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  override suspend fun beforeProject() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    println(&quot;Project starting&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  override suspend fun afterProject() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    println(&quot;Project complete&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="real-examples"></a>Real Examples<a class="hash-link" href="#real-examples" title="Direct link to heading">#</a></h2><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="system-out-listener"></a>System Out Listener<a class="hash-link" href="#system-out-listener" title="Direct link to heading">#</a></h4><p>A real example of a listener in example, is our <code>NoSystemOutListener</code> which throws an error if any output is written to standard out.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class MyTestSpec : DescribeSpec({</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    listener(NoSystemOutListener)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    describe(&quot;All these tests should not write to standard out&quot;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        it(&quot;silence in the court&quot;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          println(&quot;boom&quot;) // failure</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">})</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="timer-listener"></a>Timer Listener<a class="hash-link" href="#timer-listener" title="Direct link to heading">#</a></h4><p>Another example would be if we wanted to log the time taken for each test case. We can do this by using the <code>beforeTest</code> and <code>afterTest</code> functions
as follows:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">object TimerListener : TestListener {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  var started = 0L</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  override fun beforeTest(testCase: TestCase): Unit {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    started = System.currentTimeMillis()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  override fun afterTest(testCase: TestCase, result: TestResult): Unit {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    println(&quot;Duration of ${testCase.description} = &quot; + (System.currentTimeMillis() - started))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Then we can register like so:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class MyTestClass : FunSpec({</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  listeners(TimerListener)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // tests here</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">})</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Or we could register it project wide:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">object MyConfig : AbstractProjectConfig() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    override fun listeners(): List&lt;Listener&gt; = listOf(TimerListener)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>These functions will now be invoked for every test case inside the <code>MyTestClass</code> test class. Maybe you want
this listener to run for every test in the entire project. To do that, you would register the listener with
the project config singleton. For more information on this see <a href="/docs/framework/project-config.html">ProjectConfig</a>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/kotest/kotest/blob/master/documentation/docs/framework/listeners.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/assertions/retry.html"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Retry</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/framework/plugins.html"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Plugins Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#testlistener" class="table-of-contents__link">TestListener</a></li><li><a href="#projectlistener" class="table-of-contents__link">ProjectListener</a></li><li><a href="#how-to-use-a-listener" class="table-of-contents__link">How to use a Listener</a></li><li><a href="#real-examples" class="table-of-contents__link">Real Examples</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://kotlinlang.slack.com/archives/CT0G9SD7Z" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/kotest" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2021 Kotest, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.6e1caf73.js"></script>
<script src="/runtime~main.8c1cf63c.js"></script>
<script src="/main.dc48cc50.js"></script>
<script src="/1.d50575be.js"></script>
<script src="/83.280073a3.js"></script>
<script src="/84.2d7a49f0.js"></script>
<script src="/935f2afb.2372d9e3.js"></script>
<script src="/82.d1c7a466.js"></script>
<script src="/a9df3900.e9d351a6.js"></script>
</body>
</html>