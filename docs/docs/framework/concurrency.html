<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.69">
<title data-react-helmet="true">Concurrency | Kotest</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Concurrency | Kotest"><meta data-react-helmet="true" name="description" content="Concurrency is at the heart of Kotlin, with compiler support for continuations (suspend functions), enabling"><meta data-react-helmet="true" property="og:description" content="Concurrency is at the heart of Kotlin, with compiler support for continuations (suspend functions), enabling"><meta data-react-helmet="true" property="og:url" content="https://kotest.io/docs/framework/concurrency.html"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://kotest.io/docs/framework/concurrency.html"><link rel="stylesheet" href="/styles.f70968a8.css">
<link rel="preload" href="/styles.6e1caf73.js" as="script">
<link rel="preload" href="/runtime~main.8c1cf63c.js" as="script">
<link rel="preload" href="/main.dc48cc50.js" as="script">
<link rel="preload" href="/1.d50575be.js" as="script">
<link rel="preload" href="/83.280073a3.js" as="script">
<link rel="preload" href="/84.2d7a49f0.js" as="script">
<link rel="preload" href="/935f2afb.2372d9e3.js" as="script">
<link rel="preload" href="/82.d1c7a466.js" as="script">
<link rel="preload" href="/bdfb61c9.a1102aeb.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Kotest" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/logo.png" alt="Kotest" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Kotest</strong></a><a class="navbar__item navbar__link" href="/docs/quickstart">Overview</a><a class="navbar__item navbar__link" href="/docs/framework/framework.html">Framework</a><a class="navbar__item navbar__link" href="/docs/extensions/extensions.html">Extensions</a><a class="navbar__item navbar__link" href="/docs/assertions/assertions.html">Assertions</a><a class="navbar__item navbar__link" href="/docs/proptest/property-based-testing.html">Property Testing</a><a class="navbar__item navbar__link" href="/docs/intellij/intellij-plugin.html">Intellij Plugin</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kotest/kotest/issues" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Issue Tracker</a><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Kotest" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/logo.png" alt="Kotest" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Kotest</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/quickstart">Overview</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/framework.html">Framework</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/extensions/extensions.html">Extensions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/assertions/assertions.html">Assertions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/proptest/property-based-testing.html">Property Testing</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intellij/intellij-plugin.html">Intellij Plugin</a></li><li class="menu__list-item"><a href="https://github.com/kotest/kotest/issues" target="_blank" rel="noopener noreferrer" class="menu__link">Issue Tracker</a></li><li class="menu__list-item"><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Concurrency</h1></header><div class="markdown"><p>Concurrency is at the heart of Kotlin, with compiler support for continuations (suspend functions), enabling
the powerful coroutines library, in addition to the standard Java concurrency tools.</p><p>So it is expected that a Kotlin test framework should offer full support for executing tests concurrently, whether that is through
traditional blocking calls or suspendable functions.</p><p>Kotest offers the following features:</p><ul><li>The ability to launch specs and tests concurrently in separate coroutines to support context switching when using suspending functions.</li><li>The ability to configure multiple threads to take advantage of multi-core environments and to allow for calls that use blocking APIs.</li></ul><p>These two features are orthogonal but complimentary.</p><p>By default, Kotest will execute each test case sequentially using a single thread.
This means if a test inside a spec suspends or blocks, the whole test run will suspend or block until that test case resumes.</p><p>This is the safest default to use, since it places no burden or expectation on the user to write thread-safe tests. For example,
tests can share state or use instance fields which are not thread safe. It won&#x27;t subject your tests to race conditions or require you to know Java&#x27;s memory model. Specs can use before and after methods confidently knowing they won&#x27;t interfere with each other.</p><p>However, it is understandable that many users will want to run tests concurrently to reduce the total execution time of their test suite.
This is especially true when testing code that suspends or blocks - the performance gains from allowing tests to run concurrently can be significant.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="concurrency-mode"></a>Concurrency Mode<a class="hash-link" href="#concurrency-mode" title="Direct link to heading">#</a></h2><p>Kotest offers the ability to launch each spec and/or test in separate coroutines that can run concurrently.
Then, whenever a test suspends, another coroutine can be swapped onto that thread.</p><p>For example, if we were testing some kind of retry function, which sleeps for a period of time between invocations, the
test engine would simply be idling while the retry was suspended unless there were other coroutines that could be swapped onto the thread.</p><p>We can configure this feature by setting the configuration field <code>concurrencyMode</code> or the system property <code>kotest.framework.concurrency.mode</code>.</p><p>There are four values:</p><ul><li><code>None</code> - Launch specs and tests <strong>sequentially</strong>.</li><li><code>Spec</code> - Launch specs <strong>concurrently</strong>, but tests within each spec <strong>sequentially</strong>.</li><li><code>Test</code> - Launch specs <strong>sequentially</strong>, but tests within each spec <strong>concurrently</strong>.</li><li><code>All</code> - Launch <strong>both</strong> specs and tests <strong>concurrently</strong>.</li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>&quot;Caveats&quot;</h5></div><div class="admonition-content"><p>This setting does not change the thread count, but allows for co-operative concurrency when using suspendable functions.
If you are testing code that does not use coroutines or uses frequent blocking calls then this setting alone is not sufficient.
See the section on multiple threads.</p></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>&quot;Blocking Methods&quot;</h5></div><div class="admonition-content"><p>Usage of blocking calls - such as those from Java&#x27;s IO Api or Thread.sleep - will block the thread and not allow that
thread for other coroutines regardless of this setting.</p><p>One can either try to avoid the use of blocking calls in favour of suspendable equivalents or wrap blocking calls
inside a <code>withContext</code> block to move the offending code onto another dispatcher, such as <code>Dispatchers.IO</code>.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="concurrencymodenone"></a>ConcurrencyMode.None<a class="hash-link" href="#concurrencymodenone" title="Direct link to heading">#</a></h3><p>This is the default setting, which launches all specs and tests sequentially. That is, the next spec and test are launched
only when the previous one completes.</p><p>Consider the following specs:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class MyTest1 : FunSpec() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   init {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      test(&quot;a&quot;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      test(&quot;b&quot;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class MyTest2 : FunSpec() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   init {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      test(&quot;c&quot;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      test(&quot;d&quot;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>When using <code>ConcurrencyMode.None</code>, this would perform like the following pseudo-code:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">val spec1 = MyTest1()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">spec1.testa()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">spec1.testb()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val spec2 = MyTest2()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">spec2.testc()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">spec2.testd()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Suspension or blocking will suspend or block the entire test run. All callback methods such as <code>beforeTest</code> and <code>afterSpec</code> are
guaranteed to run in isolation.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="concurrencymodespec"></a>ConcurrencyMode.Spec<a class="hash-link" href="#concurrencymodespec" title="Direct link to heading">#</a></h3><p>This setting launches each spec at once, but tests inside each coroutine sequentially.</p><p>It is common for tests inside the same class to re-use variables or use instance fields which are not thread safe.
Even when executing specs concurrently, we may not want tests inside the same spec to run concurrently.</p><p>Using the same example as before, using <code>ConcurrencyMode.Spec</code>, this would perform like the following pseudo-code:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">launch { // coroutine 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  val spec1 = MyTest1()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  spec1.testa() // a suspend here would suspend spec1 only</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  spec1.testb() // this test will only run once testa has completed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">launch { // coroutine 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  val spec2 = MyTest2()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  spec2.testc() // a suspend here would suspend spec2 only</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  spec2.testd() // this test will only run once testc has completed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>As you can see, the two specs are launched at the same time, and will execute concurrently
but the tests inside any particular spec will still execute sequentially.</p><p>If a test case suspends, only the containing spec will suspend until that test case resumes, but other spec coroutines are free to run.</p><p>Specs must be thread-safe with respect to other specs, but tests inside each spec are free to use shared state and
thread unsafe code that is contained within that spec. Test level callback methods such as <code>beforeTest</code> and <code>afterTest</code> are
guaranteed to run in isolation, but spec level callback methods such as <code>beforeSpec</code> and <code>afterSpec</code> can run concurrently.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="concurrencymodetest"></a>ConcurrencyMode.Test<a class="hash-link" href="#concurrencymodetest" title="Direct link to heading">#</a></h3><p>This setting launches each spec sequentially, but each root test inside a spec concurrently.</p><p>With the same example as before, in <code>ConcurrencyMode.Test</code> mode, this would look like the following pseudo-code:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">coroutineScope { // the scope ensures we wait for the whole spec to complete</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  val spec1 = MyTest1()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  launch { // both tests launched at the same time</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    spec1.testa()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  launch {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    spec1.testb()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">coroutineScope { // the scope ensures we wait for the whole spec to complete</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  val spec2 = MyTest2()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  launch { // both tests launched at the same time</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    spec2.testc()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  launch {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    spec2.testd()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>As you can see, the first spec will launch all of its tests at the same time, then suspend until they complete.
Only after all the contained tests have completed, will the next spec launch.
This mode is useful if you need thread safety between specs but tests inside each spec can run thread safe.</p><p>Test level callback methods such as <code>beforeTest</code> and <code>afterTest</code> can run concurrently,
but spec level callback methods such as <code>beforeSpec</code> and <code>afterSpec</code> are guaranteed to run in isolation.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>&quot;Isolation mode&quot;</h5></div><div class="admonition-content"><p>The default isolation mode for specs is <em>single instance per class</em> - which means the same instance of
the spec class is used for all tests of that class. If you have top level variables in your class, they must
be thread safe.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="concurrencymodeall"></a>ConcurrencyMode.All<a class="hash-link" href="#concurrencymodeall" title="Direct link to heading">#</a></h3><p>This setting launches each spec concurrently and each test inside each spec concurrently. In effect, this is like
throwing all the tests into one giant pot and launching them all at the same time.</p><p>With the same example as before, in <code>ConcurrencyMode.All</code> mode, this would look like the following pseudo-code:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">launch {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  val spec1 = MyTest1()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  launch {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    spec1.testa()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  launch {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    spec1.testb()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">launch {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  val spec2 = MyTest2()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  launch {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    spec2.testc()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  launch {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    spec2.testd()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Now you can see that every spec and all tests in those specs are launched immediately.</p><p>All callback methods such as <code>beforeTest</code> and <code>afterSpec</code> can run concurrently. Users must ensure all callback is thread safe.</p><p>!!! warning
This setting will give the maximum possible performance, but every single test must be thread safe (see @Isolate)</p><p>!!! warning &quot;Isolation mode&quot;
The default isolation mode for specs is <em>single instance per class</em> - which means the same instance of
the spec class is used for all tests of that class. If you have top level variables in your class, they must
be thread safe.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="isolate-safety-hatch"></a>@Isolate Safety Hatch<a class="hash-link" href="#isolate-safety-hatch" title="Direct link to heading">#</a></h3><p>It is common to have many tests that are safe to run concurrently, while having some tests that must run in isolation.
Kotest supports this through the <code>@Isolate</code> annotation at the spec level.</p><p>Any specs annotated with this will always run sequentially, after all other specs (those not annotated) have finished.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="multiple-threads"></a>Multiple Threads<a class="hash-link" href="#multiple-threads" title="Direct link to heading">#</a></h3><p>The second feature Kotest offers for concurrency is the ability to take advantage of multiple cores.
When running in a multi-core environment, more than one spec could be executing in parallel.</p><p>Kotest supports this through the <code>parallelism</code> configuration setting or the <code>kotest.framework.parallelism</code> system property.</p><p>By default, the value is set to 1 so that the test engine would use a single thread for the entire test run.
When we set this flag to a value greater than 1, multiple threads will be created for executing tests.</p><p>For example, setting this to K will (subject to caveats around blocking tests) allow up to K tests to be executing in parallel.</p><p>This setting has no effect on Javascript tests.</p><p>!!! note &quot;Thread stickiness&quot;
When using multiple threads, all the tests of a particular spec (and the associated lifecycle callbacks) are guaranteed to be executed in the same thread.
In other words, different threads are only used across different specs.</p><p>!!! tip &quot;Blocking calls&quot;
Setting this value higher than the number of cores offers a benefit if you are testing code that is using
blocking calls and you are unable to move the calls onto another dispatcher.</p><p>!!! note
Setting parallelism &gt; 1 automatically enables <code>Spec</code> concurrency mode unless another concurrency mode is set explicitly.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/kotest/kotest/blob/master/documentation/docs/framework/concurrency.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#concurrency-mode" class="table-of-contents__link">Concurrency Mode</a><ul><li><a href="#concurrencymodenone" class="table-of-contents__link">ConcurrencyMode.None</a></li><li><a href="#concurrencymodespec" class="table-of-contents__link">ConcurrencyMode.Spec</a></li><li><a href="#concurrencymodetest" class="table-of-contents__link">ConcurrencyMode.Test</a></li><li><a href="#concurrencymodeall" class="table-of-contents__link">ConcurrencyMode.All</a></li><li><a href="#isolate-safety-hatch" class="table-of-contents__link">@Isolate Safety Hatch</a></li><li><a href="#multiple-threads" class="table-of-contents__link">Multiple Threads</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://kotlinlang.slack.com/archives/CT0G9SD7Z" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/kotest" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2021 Kotest, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.6e1caf73.js"></script>
<script src="/runtime~main.8c1cf63c.js"></script>
<script src="/main.dc48cc50.js"></script>
<script src="/1.d50575be.js"></script>
<script src="/83.280073a3.js"></script>
<script src="/84.2d7a49f0.js"></script>
<script src="/935f2afb.2372d9e3.js"></script>
<script src="/82.d1c7a466.js"></script>
<script src="/bdfb61c9.a1102aeb.js"></script>
</body>
</html>