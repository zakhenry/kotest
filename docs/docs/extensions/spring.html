<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.69">
<title data-react-helmet="true">Spring | Kotest</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Spring | Kotest"><meta data-react-helmet="true" name="description" content="Kotest offers a Spring extension that allows you to test code that wires dependencies using Spring."><meta data-react-helmet="true" property="og:description" content="Kotest offers a Spring extension that allows you to test code that wires dependencies using Spring."><meta data-react-helmet="true" property="og:url" content="https://kotest.io/docs/extensions/spring.html"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://kotest.io/docs/extensions/spring.html"><link rel="stylesheet" href="/styles.f70968a8.css">
<link rel="preload" href="/styles.6e1caf73.js" as="script">
<link rel="preload" href="/runtime~main.8c1cf63c.js" as="script">
<link rel="preload" href="/main.dc48cc50.js" as="script">
<link rel="preload" href="/1.d50575be.js" as="script">
<link rel="preload" href="/83.280073a3.js" as="script">
<link rel="preload" href="/84.2d7a49f0.js" as="script">
<link rel="preload" href="/935f2afb.2372d9e3.js" as="script">
<link rel="preload" href="/82.d1c7a466.js" as="script">
<link rel="preload" href="/10cdd5c3.c2681934.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Kotest" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/logo.png" alt="Kotest" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Kotest</strong></a><a class="navbar__item navbar__link" href="/docs/quickstart">Overview</a><a class="navbar__item navbar__link" href="/docs/framework/framework.html">Framework</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/extensions/extensions.html">Extensions</a><a class="navbar__item navbar__link" href="/docs/assertions/assertions.html">Assertions</a><a class="navbar__item navbar__link" href="/docs/proptest/property-based-testing.html">Property Testing</a><a class="navbar__item navbar__link" href="/docs/intellij/intellij-plugin.html">Intellij Plugin</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kotest/kotest/issues" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Issue Tracker</a><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Kotest" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/logo.png" alt="Kotest" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Kotest</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/quickstart">Overview</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/framework.html">Framework</a></li><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/extensions/extensions.html">Extensions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/assertions/assertions.html">Assertions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/proptest/property-based-testing.html">Property Testing</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intellij/intellij-plugin.html">Intellij Plugin</a></li><li class="menu__list-item"><a href="https://github.com/kotest/kotest/issues" target="_blank" rel="noopener noreferrer" class="menu__link">Issue Tracker</a></li><li class="menu__list-item"><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive thin-scrollbar menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/extensions/extensions.html">Introduction</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/docs/extensions/spring.html">Spring</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/extensions/ktor.html">Ktor</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/extensions/system_extensions.html">System Extensions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/extensions/test_containers.html">Test Containers</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/extensions/mockserver.html">MockServer</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/extensions/junit_xml.html">JUnit XML</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/extensions/allure.html">Allure</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/extensions/instant.html">Current Instant Listeners</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/extensions/koin.html">Koin</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/extensions/robolectric.html">Robolectric</a></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Spring</h1></header><div class="markdown"><p>Kotest offers a Spring extension that allows you to test code that wires dependencies using Spring.
To use this extension add the <code>kotest-extensions-spring</code> module to your test compile path.</p><p>The Spring extension requires you to activate it for all test classes, or per test class. To activate it globally,
register the <code>SpringExtension</code> in <a href="/docs/framework/project-config.html">project config</a>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ProjectConfig : AbstractProjectConfig() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   override fun extensions() = listOf(SpringExtension)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>To activate it per test class:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class MyTestSpec : FunSpec() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   override fun extensions() = listOf(SpringExtension)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>In order to let Spring know which configuration class to use, you must annotate your Spec classes with <code>@ContextConfiguration</code>.
This should point to a class annotated with the Spring <code>@Configuration</code> annotation. Alternatively, you can use <code>@ActiveProfile</code> to
point to a <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-profiles.html" target="_blank" rel="noopener noreferrer">specific application context file</a>.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>In Kotest 4.3 and earlier, the Spring extension was called <code>SpringListener</code>. In 4.4 and later, this extension has been deprecated
and <code>SpringExtension</code> is used instead.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="constructor-injection"></a>Constructor Injection<a class="hash-link" href="#constructor-injection" title="Direct link to heading">#</a></h3><p>For constructor injection, Kotest automatically registers a <code>SpringAutowireConstructorExtension</code>
when the spring module is added to the build.</p><p>This extension will intercept each call to create a Spec instance
and will autowire the beans declared in the primary constructor.</p><p>The following example is a test class which requires a service called <code>UserService</code> in its primary constructor. This service
class is just a regular spring bean which has been annotated with @Component.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@ContextConfiguration(classes = [(Components::class)])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class SpringAutowiredConstructorTest(service: UserService) : WordSpec() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  init {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;SpringExtension&quot; should {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;have autowired the service&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service.repository.findUser().name shouldBe &quot;system_user&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="testcontexts"></a>TestContexts<a class="hash-link" href="#testcontexts" title="Direct link to heading">#</a></h3><p>The Spring extensions makes available the <code>TestContextManager</code> via the coroutine context that tests execute in. You can
gain a handle to this instance through the <code>testContextManager()</code> extension method.</p><p>From this you can get the <code>testContext</code> that Spring is using.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class MySpec(service: UserService) : WordSpec() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  init {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;SpringExtension&quot; should {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;provide the test context manager&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         println(&quot;The context is &quot; + testContextManager().testContext)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="test-method-callbacks"></a>Test Method Callbacks<a class="hash-link" href="#test-method-callbacks" title="Direct link to heading">#</a></h3><p>Spring has various test callbacks such as <code>beforeTestMethod</code> that are based around the idea that tests are methods.
This assumption is fine for legacy test frameworks like JUnit but not applicable to modern test frameworks like Kotest where tests are functions.</p><p>Therefore, when using a <a href="/docs/framework/testing-styles.html">spec style</a> that is nested, you can customize when the test method callbacks are fired.
By default, this is on the leaf node. You can set these to fire on the root nodes by passing a SpringTestLifecycleMode argument to the extension:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ProjectConfig : AbstractProjectConfig() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   override fun extensions() = listOf(SpringTestExtension(SpringTestLifecycleMode.Root))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="final-classes"></a>Final Classes<a class="hash-link" href="#final-classes" title="Direct link to heading">#</a></h3><p>When using a final class, you may receive a warning from Kotest:</p><p><code>Using SpringListener on a final class. If any Spring annotation fails to work, try making this class open</code></p><p>If you wish, you can disable this warning by setting the system property <code>kotest.listener.spring.ignore.warning</code> to true.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/kotest/kotest/blob/master/documentation/docs/extensions/spring.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/extensions/extensions.html"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Extensions</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/extensions/ktor.html"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Ktor Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#constructor-injection" class="table-of-contents__link">Constructor Injection</a></li><li><a href="#testcontexts" class="table-of-contents__link">TestContexts</a></li><li><a href="#test-method-callbacks" class="table-of-contents__link">Test Method Callbacks</a></li><li><a href="#final-classes" class="table-of-contents__link">Final Classes</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://kotlinlang.slack.com/archives/CT0G9SD7Z" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/kotest" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2021 Kotest, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.6e1caf73.js"></script>
<script src="/runtime~main.8c1cf63c.js"></script>
<script src="/main.dc48cc50.js"></script>
<script src="/1.d50575be.js"></script>
<script src="/83.280073a3.js"></script>
<script src="/84.2d7a49f0.js"></script>
<script src="/935f2afb.2372d9e3.js"></script>
<script src="/82.d1c7a466.js"></script>
<script src="/10cdd5c3.c2681934.js"></script>
</body>
</html>