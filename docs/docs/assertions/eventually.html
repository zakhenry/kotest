<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.69">
<title data-react-helmet="true">Eventually | Kotest</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Eventually | Kotest"><meta data-react-helmet="true" name="description" content="When testing non-deterministic code, a common use case is &quot;I expect this code to pass after a short period of time&quot;."><meta data-react-helmet="true" property="og:description" content="When testing non-deterministic code, a common use case is &quot;I expect this code to pass after a short period of time&quot;."><meta data-react-helmet="true" property="og:url" content="https://kotest.io/docs/assertions/eventually.html"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://kotest.io/docs/assertions/eventually.html"><link rel="stylesheet" href="/styles.f70968a8.css">
<link rel="preload" href="/styles.6e1caf73.js" as="script">
<link rel="preload" href="/runtime~main.8c1cf63c.js" as="script">
<link rel="preload" href="/main.dc48cc50.js" as="script">
<link rel="preload" href="/1.d50575be.js" as="script">
<link rel="preload" href="/83.280073a3.js" as="script">
<link rel="preload" href="/84.2d7a49f0.js" as="script">
<link rel="preload" href="/935f2afb.2372d9e3.js" as="script">
<link rel="preload" href="/82.d1c7a466.js" as="script">
<link rel="preload" href="/adc80b36.c5774244.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Kotest" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/logo.png" alt="Kotest" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Kotest</strong></a><a class="navbar__item navbar__link" href="/docs/quickstart">Overview</a><a class="navbar__item navbar__link" href="/docs/framework/framework.html">Framework</a><a class="navbar__item navbar__link" href="/docs/extensions/extensions.html">Extensions</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/assertions/assertions.html">Assertions</a><a class="navbar__item navbar__link" href="/docs/proptest/property-based-testing.html">Property Testing</a><a class="navbar__item navbar__link" href="/docs/intellij/intellij-plugin.html">Intellij Plugin</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kotest/kotest/issues" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Issue Tracker</a><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Kotest" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/logo.png" alt="Kotest" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Kotest</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/quickstart">Overview</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/framework.html">Framework</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/extensions/extensions.html">Extensions</a></li><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/assertions/assertions.html">Assertions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/proptest/property-based-testing.html">Property Testing</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intellij/intellij-plugin.html">Intellij Plugin</a></li><li class="menu__list-item"><a href="https://github.com/kotest/kotest/issues" target="_blank" rel="noopener noreferrer" class="menu__link">Issue Tracker</a></li><li class="menu__list-item"><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive thin-scrollbar menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/assertions/assertions.html">Assertions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/assertions/matchers.html">Matchers</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/assertions/exceptions.html">Exceptions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/assertions/clues.html">Clues</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/assertions/soft-assertions.html">Soft Assertions</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Non-deterministic Testing</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/assertions/eventually.html">Eventually</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/continually.html">Continually</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/until.html">Until</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/retry.html">Retry</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/assertions/inspectors.html">Inspectors</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/assertions/assertion-mode.html">Assertion Mode</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Matcher Modules</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/core-matchers.html">Core</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/json-matchers.html">Json</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/ktor-matchers.html">Ktor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/android-matchers.html">Android</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/kotlinx-datetime-matchers.html">Kotlinx Datetime</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/arrow.html">Arrow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/sql-matchers.html">SQL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/konform-matchers.html">Konform</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/klock-matchers.html">Klock</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/compiler-matchers.html">Compiler</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/assertions/jsoup-matchers.html">Jsoup</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Eventually</h1></header><div class="markdown"><p>When testing non-deterministic code, a common use case is &quot;I expect this code to pass after a short period of time&quot;.</p><p>For example, if you were testing a IO operation, you might need to wait until the IO operation has flushed.</p><p>Sometimes you can do a Thread.sleep but this is isn&#x27;t ideal as you need to set a sleep threshold high enough so that it
won&#x27;t expire prematurely on a slow machine. Plus it means that your test will sit around waiting on the timeout even if
the code completes quickly on a fast machine.</p><p>Or you can roll a loop and sleep and retry and sleep and retry, but this is just boilerplate slowing you down.</p><p>Another common approach is to use countdown latches and this works fine if you are able to inject the latches in the
appropriate places but it isn&#x27;t always possible to have the code under test trigger a latch.</p><p>As an alternative, kotest provides the <code>eventually</code> function and the <code>Eventually</code> configuration which periodically test
the code ignoring your specified exceptions and ensuring the result satisfies an optional predicate, until the timeout
is eventually reached or too many iterations have passed. This is flexible and is perfect for testing nondeterministic
code.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="examples"></a>Examples<a class="hash-link" href="#examples" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="simple-examples"></a>Simple examples<a class="hash-link" href="#simple-examples" title="Direct link to heading">#</a></h4><p>Let&#x27;s assume that we send a message to an asynchronous service.
After the message is processed, a new row is inserted into user table.</p><p>We can check this behaviour with our <code>eventually</code> function.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class MyTests : ShouldSpec() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  init {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    should(&quot;check if user repository has one row after message is sent&quot;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      sendMessage()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      eventually(5.seconds) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        userRepository.size() shouldBe 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="exceptions"></a>Exceptions<a class="hash-link" href="#exceptions" title="Direct link to heading">#</a></h4><p>By default, <code>eventually</code> will ignore any <code>AssertionError</code> that is thrown inside the function (note, that means it won&#x27;t catch <code>Error</code>).
If you want to be more specific, you can tell <code>eventually</code> to ignore specific exceptions and any others will immediately fail the test.</p><p>Let&#x27;s assume that our example from before throws a <code>UserNotFoundException</code> while the user is not found in the database.
It will eventually return the user when the message is processed by the system.</p><p>In this scenario, we can explicitly skip the exception that we expect to happen until the test passed, but any other exceptions would
not be ignored. Note, this example is similar to the former, but if there was some other error, say a ConnectionException for example, this would cause
the eventually block to immediately exit with a failure message.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class MyTests : ShouldSpec() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  init {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    should(&quot;check if user repository has one row&quot;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      eventually(5.seconds, UserNotFoundException::class.java) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        userRepository.findBy(1) shouldNotBe null</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="predicates"></a>Predicates<a class="hash-link" href="#predicates" title="Direct link to heading">#</a></h4><p>In addition to verifying a test case eventually runs without throwing, we can also verify the result and treat a non-throwing result as failing.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class MyTests : StringSpec({</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;check that predicate eventually succeeds in time&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var i = 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    eventually&lt;Int&gt;(25.seconds, predicate = { it == 5 }) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      delay(1.seconds)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      i++</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">})</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="sharing-configuration"></a>Sharing configuration<a class="hash-link" href="#sharing-configuration" title="Direct link to heading">#</a></h4><p>Sharing the configuration for eventually is a breeze with the <code>Eventually</code> data class. Suppose you have classified the operations in your
system to &quot;slow&quot; and &quot;fast&quot; operations. Instead of remembering which timing values were for slow and fast we can set up some objects to share between tests
and customize them per suite. This is also a perfect time to show off the listener capabilities of <code>eventually</code> which give you insight
into the current value of the result of your producer and the state of iterations!</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">val slow = EventuallyConfig&lt;ServerResponse, ServerException&gt;(5.minutes, interval = 25.milliseconds.fibonacci(), exceptionClass = ServerException::class)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val fast = slow.copy(duration = 5.seconds)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class FooTests : StringSpec({</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  val logger = logger(&quot;FooTests&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  val fSlow = slow.copy(listener = { i, t -&gt; logger.info(&quot;Current $i after {${t.times} attempts&quot;)})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;server eventually provides a result for /foo&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    eventually(fSlow) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      fooApi()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class BarTests : StringSpec({</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  val logger = logger(&quot;BarTests&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  val bFast = fast.copy(listener = { i, t -&gt; logger.info(&quot;Current $i after {${t.times} attempts&quot;)})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;server eventually provides a result for /bar&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    eventually(bFast) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      barApi()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Here we can see sharing of configuration can be useful to reduce duplicate code while allowing flexibility for things like
custom logging per test suite for clear test logs.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/kotest/kotest/blob/master/documentation/docs/assertions/eventually.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/assertions/soft-assertions.html"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Soft Assertions</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/assertions/continually.html"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Continually Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#examples" class="table-of-contents__link">Examples</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://kotlinlang.slack.com/archives/CT0G9SD7Z" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/kotest" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2021 Kotest, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.6e1caf73.js"></script>
<script src="/runtime~main.8c1cf63c.js"></script>
<script src="/main.dc48cc50.js"></script>
<script src="/1.d50575be.js"></script>
<script src="/83.280073a3.js"></script>
<script src="/84.2d7a49f0.js"></script>
<script src="/935f2afb.2372d9e3.js"></script>
<script src="/82.d1c7a466.js"></script>
<script src="/adc80b36.c5774244.js"></script>
</body>
</html>